package com.hibernate;

import java.util.List;

import org.hibernate.HibernateException;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.boot.registry.StandardServiceRegistryBuilder;
import org.hibernate.cfg.Configuration;

public class Hibernate_CURD_Operations {
	
	private static SessionFactory factory;
	
	// Obtain the session factory
	public static void getSessionFactory() {
		try {
			Configuration conf = new Configuration().configure();
			StandardServiceRegistryBuilder builder = new StandardServiceRegistryBuilder()
					.applySettings(conf.getProperties());
			factory = conf.buildSessionFactory(builder.build());
		} catch (Throwable ex) {
			System.out.println("Exception is: " + ex);
			throw new ExceptionInInitializerError(ex);
		}
	}
	
	public static void main(String[] args) {
		getSessionFactory();
		Hibernate_CURD_Operations obj = new Hibernate_CURD_Operations();
		
		Employee emp1 = new Employee(101, "charan", "kumar", 50000);
		Employee emp2 = new Employee(102, "Varun", "singla", 50000);
		Employee emp3 = new Employee(103, "Saurabh", "Raj", 50000);
		
		obj.insertIntoDatabase(emp1);
		obj.insertIntoDatabase(emp2);
		obj.insertIntoDatabase(emp3);
		
		obj.displayRecords();
		
		// Example of updating a record
		obj.updateRecord(101, 60000);
		
		// Example of deleting a record
		obj.deleteRecord(103);
		
		// Display records after update and delete
		obj.displayRecords();
		
		// Close the session factory at the end
		factory.close();
	}
	
	public void insertIntoDatabase(Employee emp) {
		try {
			Session session = factory.openSession();
			Transaction tx = session.beginTransaction();
			session.save(emp);
			tx.commit();
			session.close();
		} catch (HibernateException ex) {
			System.out.println("Exception is : " + ex);
		}
	}
	
	public void displayRecords() {
		try {
			Session session = factory.openSession();
			List<Employee> empList = session.createQuery("FROM Employee").list();
			System.out.println("List of records in the db are :");
			for (Employee emp : empList)
				System.out.println(emp);
			session.close();
		} catch (HibernateException ex) {
			System.out.println(ex);
		}
	}
	
	public void updateRecord(int id, int salary) {
		try {
			Session session = factory.openSession();
			Transaction tx = session.beginTransaction();
			Employee emp = (Employee) session.get(Employee.class, id);
			emp.setSalary(salary);
			session.update(emp);
			tx.commit();
			session.close();
		} catch (HibernateException ex) {
			System.out.println(ex);
		}
	}
	
	public void deleteRecord(int id) {
		try {
			Session session = factory.openSession();
			Transaction tx = session.beginTransaction();
			Employee emp = (Employee) session.get(Employee.class, id);
			session.delete(emp);
			tx.commit();
			session.close();
		} catch (HibernateException ex) {
			System.out.println(ex);
		}
	}
}
